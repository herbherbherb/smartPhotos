app.controller("login_ctr",function($scope,$window,$rootScope,Data){$scope.username="",$scope.password="",$scope.change={noshow:!1,yesshow:!1,yes:!1},$scope.login=function(){$scope.change.noshow=!1,$scope.change.yesshow=!1,$scope.change.yes=!1,Data.login($scope.username,$scope.password).success(function(data){if("username"===data.message&&($scope.change.noshow=!0),"password"===data.message&&($scope.change.yesshow=!0),"yes"===data.message){$scope.change.yes=!0,$rootScope.login_name=$scope.username,data=data.result;for(var i=0;i<data.length;i++){var cur_image="data:image/png;base64,"+data[i].image["py/b64"],cur_title=data[i].title,cur_label=data[i].label.split(",");$rootScope.stepsModel.push({image:cur_image,title:cur_title,rank:i+$rootScope.stepsModel.length,labels:cur_label})}$window.location.href="#/list/"}}).error(function(data){})},$scope.register=function(){$window.location.href="#/register/"}}),app.controller("register_ctr",function($scope,$window,$rootScope,Data){$scope.username="",$scope.password="",$scope.change={noshow:!1,yesshow:!1},$scope.register=function(){$scope.change.noshow=!1,$scope.change.noshow=!1,Data.register($scope.username,$scope.password).success(function(data){"no"===data.message&&($scope.change.noshow=!0),"yes"===data.message&&($scope.change.yesshow=!0,setTimeout(function(){$window.location.href="#/login/"},1500))}).error(function(data){})}}),app.controller("gal_ctr",function($scope,$rootScope,Data){function check(labels,queryString){for(c=0;c<labels.length;c++)if(queryString.includes(labels[c])||labels[c].includes(queryString))return!0;return!1}$scope.search="null",$scope.query="",$scope.showMovie=function(item){var result=!1;if("all"===$scope.search)return!0;if("null"===$scope.search)return!0;for(i=0;i<$rootScope.stepsModel.length;i++)if($rootScope.stepsModel[i].title===item.title){for(j=0;j<$rootScope.stepsModel[i].labels.length;j++)if($scope.search===$rootScope.stepsModel[i].labels[j]){result=!0;break}break}return result},$scope.queryMovie=function(item){if(""===$scope.query)return!0;var queryinput=$scope.query.toLowerCase().replace("airplane","aeroplane").replace("airplanes","aeroplane").replace("plane","aeroplane").replace("bike","bicycle").replace("bikes","bicycle").replace("bicycles","bicycle").replace("birds","bird").replace("boats","boat").replace("ships","boat").replace("bottles","bottle").replace("buses","bus").replace("cars","car").replace("cats","cat").replace("chairs","chair").replace("cows","cow").replace("dogs","dog").replace("horses","horse").replace("motorbikes","motorbike").replace("motorcycles","motorbike").replace("people","person").replace("tv","tvmonitor");if(queryinput.includes("and")){for(i=0;i<$rootScope.stepsModel.length;i++)if($rootScope.stepsModel[i].title===item.title){var result=!0;for(querySplit=queryinput.split("and"),j=0;j<querySplit.length;j++)result=result&&check($rootScope.stepsModel[i].labels,querySplit[j].replace(/\s/g,""));return result}}else if(queryinput.includes("or")){for(i=0;i<$rootScope.stepsModel.length;i++)if($rootScope.stepsModel[i].title===item.title){var result=!1;for(querySplit=queryinput.split("or"),j=0;j<querySplit.length;j++)result=result||check($rootScope.stepsModel[i].labels,querySplit[j]);return result}}else for(i=0;i<$rootScope.stepsModel.length;i++)if($rootScope.stepsModel[i].title===item.title){for(j=0;j<$rootScope.stepsModel[i].labels.length;j++)if(queryinput.includes($rootScope.stepsModel[i].labels[j]))return!0;break}},$scope.username="",$scope.myFunc=function(item){$scope.username=item.title}}),app.controller("summary_ctr",function($scope,$routeParams,$rootScope,Data){var login_name=$rootScope.login_name;$scope.share={show1:!1},""===login_name&&($scope.share.show1=!0),$scope.labels=[],$scope.data=[],Data.get_summary(login_name).success(function(data){$scope.share.show1=!1;for(var key in data.result)data.result.hasOwnProperty(key)&&($scope.labels.push(key),$scope.data.push(data.result[key]))}).error(function(data){})}),app.controller("list_ctr",function($scope,$rootScope,Data){$scope.search={by:"title","in":!1,stri:""},$scope.username="",$scope.myFunc=function(item){$scope.username=item.title},$scope.imageUpload=function(event){for(var files=event.target.files,i=0;i<files.length;i++){var file=files[i],reader=new FileReader;reader.onload=$scope.imageIsLoaded(file,i),reader.readAsDataURL(file)}},$scope.imageIsLoaded=function(f,i){return function(e){var base64result=e.target.result.substr(e.target.result.indexOf(",")+1);$rootScope.stepsModel.push({image:e.target.result,title:f.name,rank:i,labels:[]}),Data.postImage(JSON.stringify({image:base64result,name:f.name,user:$rootScope.login_name})).success(function(data){for(i=0;i<$rootScope.stepsModel.length;i++)if(data.name===$rootScope.stepsModel[i].title){$rootScope.stepsModel[i].labels=data.labels;break}}).error(function(data){})}}}),app.controller("share_ctr",function($scope,$routeParams,$rootScope,Data){$scope.shared_images=[],$scope.share={show1:!1};var login_name=$rootScope.login_name;Data.get_shared_image(login_name).success(function(data){if("no"===data.message&&($scope.share.show1=!0),"yes"===data.message){data=data.result;for(var i=0;i<data.length;i++){var cur_image="data:image/png;base64,"+data[i].image["py/b64"],cur_title=data[i].title,share_person=data[i].share_person;$scope.shared_images.push({image:cur_image,title:cur_title,share_person:share_person})}}}).error(function(data){})}),app.controller("detail_ctr",function($scope,$routeParams,$rootScope,$window,Data){$scope.username=$routeParams.username,$scope.change={name:$scope.username,show:!1},$scope.share={name:"",show1:!1,show2:!1},$scope.share_image=function(){$scope.share.show1=!1,$scope.share.show2=!1;var image_name=$scope.username,username=$scope.share.name,login_name=$rootScope.login_name;Data.share_image(login_name,username,image_name).success(function(data){"no"===data.message&&($scope.share.show1=!0),"yes"===data.message&&($scope.share.show2=!0)}).error(function(data){})};var login_name=$rootScope.login_name;$scope["delete"]=function(){for(i=0;i<$rootScope.stepsModel.length;i++){var current=$rootScope.stepsModel[i];if($scope.username===current.title){i===$rootScope.stepsModel.length-1?$scope.nextRight=$rootScope.stepsModel[0].title:$scope.nextRight=$rootScope.stepsModel[i+1].title;break}}for(var i=0;i<$rootScope.stepsModel.length&&$scope.username!==$rootScope.stepsModel[i].title;i++);$rootScope.stepsModel.splice(i,1),Data.delete_image(login_name,$scope.username)},$scope.reset=function(){if($scope.change.show=!1,$scope.change.name===$scope.username)return void($scope.change.show=!0);for(i=0;i<$rootScope.stepsModel.length;i++)if($scope.change.name===$rootScope.stepsModel[i].title)return void($scope.change.show=!0);for(i=0;i<$rootScope.stepsModel.length;i++){var current=$rootScope.stepsModel[i];if($scope.username===current.title){$rootScope.stepsModel[i].title=$scope.change.name,Data.putLabel($scope.username,$scope.change.name,$rootScope.login_name),$scope.username=$scope.change.name;break}}},$scope.showMovie=function(movie){var current_id=movie.title;return current_id===$scope.username},$scope.label="None",$scope.processed="",Data.getImage($scope.username).success(function(data){$scope.processed="data:image/png;base64,"+data.image["py/b64"]}).error(function(data){$scope.processed=""}),Data.getLabel($scope.username).success(function(data){$scope.label=data.label}).error(function(data){$scope.label="None"}),$scope.nextRight="",$scope.nextLeft="",$scope.rightFunc=function(){for(i=0;i<$rootScope.stepsModel.length;i++){var current=$rootScope.stepsModel[i];if($scope.username===current.title){i===$rootScope.stepsModel.length-1?$scope.nextRight=$rootScope.stepsModel[0].title:$scope.nextRight=$rootScope.stepsModel[i+1].title;break}}},$scope.leftFunc=function(){for(i=0;i<$rootScope.stepsModel.length;i++){var current=$rootScope.stepsModel[i];if($scope.username===current.title){0===i?$scope.nextLeft=$rootScope.stepsModel[$rootScope.stepsModel.length-1].title:$scope.nextLeft=$rootScope.stepsModel[i-1].title;break}}}});